name: Render Markdown

on:
  workflow_dispatch:

env:
  PYTHON_VERSION: "3.10"

jobs:
  render:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Checkout Dynamic Markdown Code
        uses: actions/checkout@v3
        with:
          repository: dreadster3/dynamic_markdown
          path: tools/

      - name: Set up Python ${{env.PYTHON_VERSION}}
        uses: actions/setup-python@v3
        with:
          python-version: ${{env.PYTHON_VERSION}}

      - name: Install Markdown Renderer
        run: cd tools && pip install .

      - name: Render Files
        run: render_markdown -v variables.json ./template_markdown.md ./README.md extra=some_extra_variable

      - name: Commit Changes
        run: |
          git config --global user.name 'dreadster3'
          git config --global user.email 'dreadster3@users.noreply.github.com'
          git add "README.md"
          git commit -am "AUTOGENERATED - Render README"
          git push
